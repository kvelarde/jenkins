---
- job:
    name: fmc-cloud-search-indexer
    project-type: pipeline
    description: "NonProd: Deploy fmc-cloud-search-indexer docker service"
    disabled: false
    display-name: "JENKINS: Deploy fmc-cloud-search-indexer docker service"
    logrotate:
      daysToKeep: 10
      numToKeep: 50
    publisher:
      - email:
        recipients: kurtis.velarde@fox.com
    dsl: |
          import hudson.EnvVars
          node('docker') {

          stage("Pull"){
            println "pulling: ssh://git@repo.foxemf.com:7999/fts/fmc-cloud-search-indexer.git"
          }

          stage("Unit/Build"){
            println "Test and Build: docker build -t fmc-cloud-search-indexer:0.${env.BUILD_NUMBER} ." 
          }

          stage("Publish"){
            println "Push image: docker push fmc-cloud-search-indexer:0.${env.BUILD_NUMBER} ...."
          }

          stage("Deploy to nonprod"){
            println("docker service update --image fmc-cloud-search-indexer:0.${env.BUILD_NUMBER} fmc-cloud-search-indexer")
          }
 
          }
